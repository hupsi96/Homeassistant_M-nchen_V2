##################################################################################################
# Smart Button Automation
#
#
# Flo
##################################################################################################

- alias: Turn_on_Flo
  trigger:
    - platform: state
      entity_id: sensor.0x0017880108005bb6_action
      to: 'on'
    - platform: state
      entity_id: sensor.0x0017880108005bb6_action
      to: 'off'
  condition:
    - condition: state
      entity_id: 'light.flo_fado'
      state: 'off'
  action:
    - service: rest_command.flo_lightOn_request
    - service: timer.start
      entity_id: timer.flo_debounce

- alias: Turn_off_Flo
  trigger:
    - platform: state
      entity_id: sensor.0x0017880108005bb6_action
      to: 'on'
    - platform: state
      entity_id: sensor.0x0017880108005bb6_action
      to: 'off'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: 'light.flo_fado'
        state: 'on'
      - condition: state
        entity_id: timer.flo_debounce
        state: idle
  action:
    service: rest_command.flo_lightOff_request

- alias: Switch_Flo
  trigger:
    - platform: state
      entity_id: sensor.0x0017880108005bb6_action
      to: 'on'
    - platform: state
      entity_id: sensor.0x0017880108005bb6_action
      to: 'off'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: 'light.flo_fado'
        state: 'on'
      - condition: state
        entity_id: timer.flo_debounce
        state: active
  action:
    - service: input_select.select_next
      entity_id: input_select.scene_flo
    - service: hue.hue_activate_scene
      data_template: 
        group_name: "Flo"
        scene_name: >
          {{ states('input_select.scene_flo') }}
    - service: timer.start
      entity_id: timer.flo_debounce

- alias: Night_Switch_Flo
  trigger:
    - platform: state
      entity_id: sensor.0x0017880108005bb6_action
      to: 'skip_backward'
  action:
    - service_template: >
        {% if is_state('input_boolean.flo_nachtmodus', 'off') %}
          rest_command.flo_lightoff_request
        {% else %} 
          rest_command.flo_lighton_request
        {% endif %}
    - service_template: >
        {% if is_state('input_boolean.flo_nachtmodus', 'off') %}
          input_boolean.turn_on
        {% else %} 
          input_boolean.turn_off
        {% endif %}
      entity_id: input_boolean.flo_nachtmodus


# Template for using data_tamplate {{ trigger.from_state.state }}
# data_template: 
#         group_name: "Flo" #TODO: change to "Gang" after creating in HUE App
#         scene_name: >
#           {% if is_state('input_select.scene_flo', 'on') or (is_state('input_boolean.flo_nachtmodus', 'on') and is_state('input_boolean.simon_nachtmodus', 'on')) %} 
#             Nacht 2
#           {% else %} 
#             Hell
#           {% endif %}

#{% if (is_state('input_boolean.christian_nachtmodus', 'on') and is_state('device_tracker.iphonevhristian', 'home')) or (is_state('device_tracker.iphonevhristian', 'not_home') and is_state('input_boolean.flo_nachtmodus', 'on') and is_state('input_boolean.simon_nachtmodus', 'on') and is_state('device_tracker.flos_iphone', 'home') and is_state('device_tracker.iphone_von_simon', 'home')) or (is_state('device_tracker.iphonevhristian', 'not_home') and is_state('input_boolean.flo_nachtmodus', 'on') and is_state('device_tracker.flos_iphone', 'home') and is_state('device_tracker.iphone_von_simon', 'not_home')) or (is_state('device_tracker.iphonevhristian', 'not_home') and is_state('input_boolean.simon_nachtmodus', 'on') and is_state('device_tracker.flos_iphone', 'not_home') and is_state('device_tracker.iphone_von_simon', 'home')) %}

##################################################################################################
# Garderobe Motion Detection
##################################################################################################

- alias: Garderobe_turn_on
  initial_state: true
  trigger:
    - platform: state
      entity_id: binary_sensor.0x0017880106f68789_occupancy #Replace with motion detector id
      to: 'on'
  condition:
    #- condition: template
    #  value_template: "{{ (state_attr('binary_sensor.0x0017880106f68789_occupancy', 'illuminance_lux')|int) < 100 }}"
    - condition: template
      value_template: "{{ (state_attr('binary_sensor.0x0017880106f68789_occupancy', 'occupancy')) }}"
    - condition: state
      entity_id:  timer.garderobe_debounce_dim
      state: 'idle'
  action:
    - service_template: >
        {% if (is_state('input_boolean.christian_nachtmodus', 'on') and is_state('device_tracker.iphonevhristian', 'home')) or (is_state('device_tracker.iphonevhristian', 'not_home') and is_state('input_boolean.flo_nachtmodus', 'on') and is_state('input_boolean.simon_nachtmodus', 'on') and is_state('device_tracker.flos_iphone', 'home') and is_state('device_tracker.iphone_von_simon', 'home')) or (is_state('device_tracker.iphonevhristian', 'not_home') and is_state('input_boolean.flo_nachtmodus', 'on') and is_state('device_tracker.flos_iphone', 'home') and is_state('device_tracker.iphone_von_simon', 'not_home')) or (is_state('device_tracker.iphonevhristian', 'not_home') and is_state('input_boolean.simon_nachtmodus', 'on') and is_state('device_tracker.flos_iphone', 'not_home') and is_state('device_tracker.iphone_von_simon', 'home')) and is_state('group.garderobe', 'off') %}
          rest_command.garderobe_lightonnight_request
        {% elif (is_state('input_boolean.christian_nachtmodus', 'on') and is_state('device_tracker.iphonevhristian', 'home')) or (is_state('device_tracker.iphonevhristian', 'not_home') and is_state('input_boolean.flo_nachtmodus', 'on') and is_state('input_boolean.simon_nachtmodus', 'on') and is_state('device_tracker.flos_iphone', 'home') and is_state('device_tracker.iphone_von_simon', 'home')) or (is_state('device_tracker.iphonevhristian', 'not_home') and is_state('input_boolean.flo_nachtmodus', 'on') and is_state('device_tracker.flos_iphone', 'home') and is_state('device_tracker.iphone_von_simon', 'not_home')) or (is_state('device_tracker.iphonevhristian', 'not_home') and is_state('input_boolean.simon_nachtmodus', 'on') and is_state('device_tracker.flos_iphone', 'not_home') and is_state('device_tracker.iphone_von_simon', 'home')) and is_state('group.garderobe', 'on') %}
            rest_command.garderobe_lightonnight_recall_request
        {% elif is_state('group.garderobe', 'off') %} 
          rest_command.garderobe_lighton_request
        {% else %}
          rest_command.garderobe_lighton_recall_request
        {% endif %}
    - service: timer.cancel
      entity_id: timer.garderobe_debounce
    - service: timer.start
      entity_id: timer.garderobe_debounce
    - service: timer.cancel
      entity_id: timer.garderobe_debounce_dim
    - service: timer.start
      entity_id: timer.garderobe_debounce_dim
    
- alias: Garderobe_keep_turn_on
  initial_state: true
  trigger:
    - platform: state
      entity_id: binary_sensor.0x0017880106f68789_occupancy #Replace with motion detector id
  condition:
    #- condition: template
    #  value_template: "{{ (state_attr('binary_sensor.0x0017880106f68789_occupancy', 'illuminance_lux')|int) < 100 }}"
    - condition: template
      value_template: "{{ (state_attr('binary_sensor.0x0017880106f68789_occupancy', 'occupancy')) }}"
    - condition: state
      entity_id:  timer.garderobe_debounce
      state: 'active'
  action:
    - service: timer.cancel
      entity_id: timer.garderobe_debounce
    - service: timer.start
      entity_id: timer.garderobe_debounce
    - service: timer.cancel
      entity_id: timer.garderobe_debounce_dim
    - service: timer.start
      entity_id: timer.garderobe_debounce_dim

- alias: Garderobe_dim
  initial_state: true
  trigger:
    - platform: event
      event_type: timer.finished
      event_data:
        entity_id: timer.garderobe_debounce_dim
  action:
    - service_template: >
        {% if (is_state('input_boolean.christian_nachtmodus', 'on') and is_state('device_tracker.iphonevhristian', 'home')) or (is_state('device_tracker.iphonevhristian', 'not_home') and is_state('input_boolean.flo_nachtmodus', 'on') and is_state('input_boolean.simon_nachtmodus', 'on') and is_state('device_tracker.flos_iphone', 'home') and is_state('device_tracker.iphone_von_simon', 'home')) or (is_state('device_tracker.iphonevhristian', 'not_home') and is_state('input_boolean.flo_nachtmodus', 'on') and is_state('device_tracker.flos_iphone', 'home') and is_state('device_tracker.iphone_von_simon', 'not_home')) or (is_state('device_tracker.iphonevhristian', 'not_home') and is_state('input_boolean.simon_nachtmodus', 'on') and is_state('device_tracker.flos_iphone', 'not_home') and is_state('device_tracker.iphone_von_simon', 'home')) and is_state('group.group.garderobe', 'off') %}
          rest_command.garderobe_lightonnight_request
        {% elif (is_state('input_boolean.christian_nachtmodus', 'on') and is_state('device_tracker.iphonevhristian', 'home')) or (is_state('device_tracker.iphonevhristian', 'not_home') and is_state('input_boolean.flo_nachtmodus', 'on') and is_state('input_boolean.simon_nachtmodus', 'on') and is_state('device_tracker.flos_iphone', 'home') and is_state('device_tracker.iphone_von_simon', 'home')) or (is_state('device_tracker.iphonevhristian', 'not_home') and is_state('input_boolean.flo_nachtmodus', 'on') and is_state('device_tracker.flos_iphone', 'home') and is_state('device_tracker.iphone_von_simon', 'not_home')) or (is_state('device_tracker.iphonevhristian', 'not_home') and is_state('input_boolean.simon_nachtmodus', 'on') and is_state('device_tracker.flos_iphone', 'not_home') and is_state('device_tracker.iphone_von_simon', 'home')) and is_state('group.group.garderobe', 'on') %}
          rest_command.garderobe_lightonnight_recall_request
        {% elif is_state('group.group.garderobe', 'off') %} 
          rest_command.garderobe_lighton_dim_request
        {% else %}
          rest_command.garderobe_lighton_recall_dim_request
        {% endif %}

- alias: Garderobe_off
  trigger:
    - platform: event
      event_type: timer.finished
      event_data:
        entity_id: timer.garderobe_debounce
  action:
    - service: rest_command.garderobe_lightoff_request

##################################################################################################
# Gang Motion Detection
##################################################################################################

- alias: Gang_turn_on
  initial_state: true
  trigger:
    - platform: state
      entity_id: binary_sensor.0x0017880106f671d9_occupancy
      to: 'on'
  condition:
    #- condition: template
    #  value_template: "{{ (state_attr('binary_sensor.0x0017880106f671d9_occupancy', 'illuminance_lux')|int) < 100 }}"
    - condition: template
      value_template: "{{ (state_attr('binary_sensor.0x0017880106f671d9_occupancy', 'occupancy')) }}"
    - condition: state
      entity_id:  timer.gang_debounce_dim
      state: 'idle'
  action:
    - service_template: >
        {% if (is_state('input_boolean.christian_nachtmodus', 'on') and is_state('device_tracker.iphonevhristian', 'home')) or (is_state('device_tracker.iphonevhristian', 'not_home') and is_state('input_boolean.flo_nachtmodus', 'on') and is_state('input_boolean.simon_nachtmodus', 'on') and is_state('device_tracker.flos_iphone', 'home') and is_state('device_tracker.iphone_von_simon', 'home')) or (is_state('device_tracker.iphonevhristian', 'not_home') and is_state('input_boolean.flo_nachtmodus', 'on') and is_state('device_tracker.flos_iphone', 'home') and is_state('device_tracker.iphone_von_simon', 'not_home')) or (is_state('device_tracker.iphonevhristian', 'not_home') and is_state('input_boolean.simon_nachtmodus', 'on') and is_state('device_tracker.flos_iphone', 'not_home') and is_state('device_tracker.iphone_von_simon', 'home')) and is_state('group.gang', 'off') %}
          rest_command.gang_lightonnight_request
        {% elif (is_state('input_boolean.christian_nachtmodus', 'on') and is_state('device_tracker.iphonevhristian', 'home')) or (is_state('device_tracker.iphonevhristian', 'not_home') and is_state('input_boolean.flo_nachtmodus', 'on') and is_state('input_boolean.simon_nachtmodus', 'on') and is_state('device_tracker.flos_iphone', 'home') and is_state('device_tracker.iphone_von_simon', 'home')) or (is_state('device_tracker.iphonevhristian', 'not_home') and is_state('input_boolean.flo_nachtmodus', 'on') and is_state('device_tracker.flos_iphone', 'home') and is_state('device_tracker.iphone_von_simon', 'not_home')) or (is_state('device_tracker.iphonevhristian', 'not_home') and is_state('input_boolean.simon_nachtmodus', 'on') and is_state('device_tracker.flos_iphone', 'not_home') and is_state('device_tracker.iphone_von_simon', 'home')) and is_state('group.gang', 'on') %}
          rest_command.gang_lightonnight_recall_request
        {% elif (is_state('group.gang', 'off')) %} 
          rest_command.gang_lighton_request
        {% else %}
          rest_command.gang_lighton_recall_request
        {% endif %}
    - service: timer.cancel
      entity_id: timer.gang_debounce
    - service: timer.start
      entity_id: timer.gang_debounce
    - service: timer.cancel
      entity_id: timer.gang_debounce_dim
    - service: timer.start
      entity_id: timer.gang_debounce_dim
    
- alias: Gang_keep_turn_on
  initial_state: true
  trigger:
    - platform: state
      entity_id: binary_sensor.0x0017880106f671d9_occupancy
  condition:
    #- condition: template
    #  value_template: "{{ (state_attr('binary_sensor.0x0017880106f671d9_occupancy', 'illuminance_lux')|int) < 100 }}"
    - condition: template
      value_template: "{{ (state_attr('binary_sensor.0x0017880106f671d9_occupancy', 'occupancy')) }}"
    - condition: state
      entity_id:  timer.gang_debounce_dim
      state: 'active'
  action:
    - service: timer.cancel
      entity_id: timer.gang_debounce
    - service: timer.start
      entity_id: timer.gang_debounce
    - service: timer.cancel
      entity_id: timer.gang_debounce_dim
    - service: timer.start
      entity_id: timer.gang_debounce_dim

- alias: Gang_dim
  initial_state: true
  trigger:
    - platform: event
      event_type: timer.finished
      event_data:
        entity_id: timer.gang_debounce_dim
  action:
    - service_template: >
        {% if (is_state('input_boolean.christian_nachtmodus', 'on') and is_state('device_tracker.iphonevhristian', 'home')) or (is_state('device_tracker.iphonevhristian', 'not_home') and is_state('input_boolean.flo_nachtmodus', 'on') and is_state('input_boolean.simon_nachtmodus', 'on') and is_state('device_tracker.flos_iphone', 'home') and is_state('device_tracker.iphone_von_simon', 'home')) or (is_state('device_tracker.iphonevhristian', 'not_home') and is_state('input_boolean.flo_nachtmodus', 'on') and is_state('device_tracker.flos_iphone', 'home') and is_state('device_tracker.iphone_von_simon', 'not_home')) or (is_state('device_tracker.iphonevhristian', 'not_home') and is_state('input_boolean.simon_nachtmodus', 'on') and is_state('device_tracker.flos_iphone', 'not_home') and is_state('device_tracker.iphone_von_simon', 'home'))and (is_state('group.gang', 'off')) %}
          rest_command.gang_lightonnight_request
        {% elif (is_state('input_boolean.christian_nachtmodus', 'on') and is_state('device_tracker.iphonevhristian', 'home')) or (is_state('device_tracker.iphonevhristian', 'not_home') and is_state('input_boolean.flo_nachtmodus', 'on') and is_state('input_boolean.simon_nachtmodus', 'on') and is_state('device_tracker.flos_iphone', 'home') and is_state('device_tracker.iphone_von_simon', 'home')) or (is_state('device_tracker.iphonevhristian', 'not_home') and is_state('input_boolean.flo_nachtmodus', 'on') and is_state('device_tracker.flos_iphone', 'home') and is_state('device_tracker.iphone_von_simon', 'not_home')) or (is_state('device_tracker.iphonevhristian', 'not_home') and is_state('input_boolean.simon_nachtmodus', 'on') and is_state('device_tracker.flos_iphone', 'not_home') and is_state('device_tracker.iphone_von_simon', 'home'))and (is_state('group.gang', 'on')) %}
          rest_command.gang_lightonnight_recall_request
        {% elif (is_state('group.gang', 'off')) %} 
          rest_command.gang_lighton_dim_request
        {% else %}
          rest_command.gang_lighton_dim_recall_request
        {% endif %}

- alias: Gang_off
  initial_state: true
  trigger:
    - platform: event
      event_type: timer.finished
      event_data:
        entity_id: timer.gang_debounce
  action:
    - service: rest_command.gang_lightoff_request

##################################################################################################
# Wifi Down automation
##################################################################################################

- alias: Wifi_down
  initial_state: true
  trigger:
    - platform: state
      entity_id: input_boolean.wifi_down
      from: "off"
      to: "on"
  action:
    - service: homeassistant.turn_off
      entity_id: automation.flo_coming_home_light

- alias: Wifi_down
  initial_state: true
  trigger:
    - platform: state
      entity_id: input_boolean.wifi_down
      from: "on"
      to: "off"
  action:
    - service: homeassistant.turn_on
      entity_id: automation.flo_coming_home_light

##################################################################################################
# Smart Button Christian
##################################################################################################
- alias: Turn_on_Chris
  trigger:
    - platform: state
      entity_id: sensor.0x0017880108005baf_action
      to: 'on'
    - platform: state
      entity_id: sensor.0x0017880108005baf_action
      to: 'off'
  condition:
    - condition: state
      entity_id: 'light.christian_2'
      state: 'off'
  action:
    - service: rest_command.chris_lighton_request
    - service: timer.start
      entity_id: timer.chris_debounce

- alias: Turn_off_Chris
  trigger:
    - platform: state
      entity_id: sensor.0x0017880108005baf_action
      to: 'on'
    - platform: state
      entity_id: sensor.0x0017880108005baf_action
      to: 'off'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: 'light.christian_2'
        state: 'on'
      - condition: state
        entity_id: timer.chris_debounce
        state: idle
  action:
    service: rest_command.chris_lightoff_request

- alias: Switch_Flo
  trigger:
    - platform: state
      entity_id: sensor.0x0017880108005baf_action
      to: 'on'
    - platform: state
      entity_id: sensor.0x0017880108005baf_action
      to: 'off'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: 'light.christian_2'
        state: 'on'
      - condition: state
        entity_id: timer.chris_debounce
        state: active
  action:
    - service: input_select.select_next
      entity_id: input_select.scene_flo
    - service: hue.hue_activate_scene
      data_template: 
        group_name: "Flo"
        scene_name: >
          {{ states('input_select.scene_flo') }}
    - service: timer.start
      entity_id: timer.flo_debounce

- alias: Night_Switch_Flo
  trigger:
    - platform: state
      entity_id: sensor.0x0017880108005bb6_action
      to: 'skip_backward'
  action:
    - service_template: >
        {% if is_state('input_boolean.flo_nachtmodus', 'off') %}
          rest_command.flo_lightoff_request
        {% else %} 
          rest_command.flo_lighton_request
        {% endif %}
    - service_template: >
        {% if is_state('input_boolean.flo_nachtmodus', 'off') %}
          input_boolean.turn_on
        {% else %} 
          input_boolean.turn_off
        {% endif %}
      entity_id: input_boolean.flo_nachtmodus

##################################################################################################
# Smart Button Simon
##################################################################################################


###################################################
# Comming Home automation - All
###################################################

# - alias: 'Comming Home Light'
#   initial_state: true
#   trigger:
#     - platform: state
#       entity_id: device_tracker.iphonevhristian #WiFi based
#       to: 'home'
#     - platform: state
#       entity_id: device_tracker.iphone_von_simon #WiFi based
#       to: 'home'
#     - platform: state
#       entity_id: device_tracker.flos_iphone #WiFi based
#       to: 'home'
#     - platform: state
#       entity_id: device_tracker.iphonevranziska #WiFi based
#       to: 'home'
#   condition:
#     condition: or
#     conditions:
#       - condition: sun
#         before: sunrise
#         before_offset: "+01:00:00"
#       - condition: sun
#         after: sunset
#         after_offset: "-01:00:00"
#       - condition: and
#         conditions:
#           - condition: state
#             entity_id: device_tracker.iphone_von_simon # Wifi
#             state: 'not_home'
#           - condition: state
#             entity_id: device_tracker.flos_iphone # Wifi
#             state: 'not_home'
#           - condition: state
#             entity_id: device_tracker.iphonevranziska # Wifi
#             state: 'not_home'
#           - condition: state
#             entity_id: device_tracker.iphone_von_christian # GPS
#             state: 'home' #GPS
#           - condition: state
#             entity_id: device_tracker.simons_iphone
#             state: 'not_home' # GPS
#           - condition: state
#             entity_id: device_tracker.flos_iphone_2
#             state: 'not_home' # GPS
#       - condition: and
#         conditions:
#           - condition: state
#             entity_id: device_tracker.iphonevhristian # Wifi
#             state: 'not_home'
#           - condition: state
#             entity_id: device_tracker.flos_iphone # Wifi
#             state: 'not_home'
#           - condition: state
#             entity_id: device_tracker.iphonevranziska # Wifi
#             state: 'not_home'
#           - condition: state
#             entity_id: device_tracker.iphone_von_christian # GPS
#             state: 'not_home' #GPS
#           - condition: state
#             entity_id: device_tracker.simons_iphone
#             state: 'home' # GPS
#           - condition: state
#             entity_id: device_tracker.flos_iphone_2
#             state: 'not_home' # GPS
#       - condition: and
#         conditions:
#           - condition: state
#             entity_id: device_tracker.iphonevhristian # Wifi
#             state: 'not_home'
#           - condition: state
#             entity_id: device_tracker.iphone_von_simon # Wifi
#             state: 'not_home'
#           - condition: state
#             entity_id: device_tracker.iphonevranziska # Wifi
#             state: 'not_home'
#           - condition: state
#             entity_id: device_tracker.iphone_von_christian # GPS
#             state: 'not_home' #GPS
#           - condition: state
#             entity_id: device_tracker.simons_iphone
#             state: 'not_home' # GPS
#           - condition: state
#             entity_id: device_tracker.flos_iphone_2
#             state: 'home' # GPS
#       - condition: and
#         conditions:
#           - condition: state
#             entity_id: device_tracker.iphonevhristian # Wifi
#             state: 'not_home'
#           - condition: state
#             entity_id: device_tracker.iphone_von_simon # Wifi
#             state: 'not_home'
#           - condition: state
#             entity_id: device_tracker.flos_iphone # Wifi
#             state: 'not_home'
#           - condition: state
#             entity_id: device_tracker.iphone_von_christian # GPS
#             state: 'not_home' #GPS
#           - condition: state
#             entity_id: device_tracker.simons_iphone
#             state: 'not_home' # GPS
#           - condition: state
#             entity_id: device_tracker.flos_iphone_2
#             state: 'not_home' # GPS
#   action:
#     - service: hue.hue_activate_scene
#       data:
#         group_name: Wohnzimmer
#         scene_name: Entspannt
#     - service: hue.hue_activate_scene
#       data_template:
#         group_name: >
#           {% if  {{ trigger.entity_id }} == 'device_tracker.iphonevhristian' %}
#             Christian
#           {% elif  {{ trigger.entity_id }} == 'device_tracker.iphone_von_simon' %}
#             Simon
#           {% elif  {{ trigger.entity_id }} == 'device_tracker.flos_iphone' or {{ trigger.entity_id }} == 'entity_id: device_tracker.iphonevranziska'%}
#             Flo
#           {% end if %}
#         scene_name: > 
#           {% if  {{ trigger.entity_id }} == 'device_tracker.iphonevhristian' %}
#             Christian
#           {% elif  {{ trigger.entity_id }} == 'device_tracker.iphone_von_simon' %}
#             Simon
#           {% elif  {{ trigger.entity_id }} == 'device_tracker.flos_iphone' or {{ trigger.entity_id }} == 'entity_id: device_tracker.iphonevranziska'%}
#             Flo
#           {% end if %}
          
# - alias: 'Comming Home Music'
# #rework sonos setting to play music when coming home and say hello
#   initial_state: false
#   trigger:
#     - platform: state
#       entity_id: device_tracker.iphonevhristian #WiFi based
#       to: 'home'
#     - platform: state
#       entity_id: device_tracker.iphone_von_simon #WiFi based
#       to: 'home'
#     - platform: state
#       entity_id: device_tracker.flos_iphone #WiFi based
#       to: 'home'
#     - platform: state
#       entity_id: device_tracker.iphonevranziska #WiFi based
#       to: 'home'
#   condition:
#     condition: or
#     conditions:
#       - condition: and
#         conditions:
#           - condition: state
#             entity_id: device_tracker.iphone_von_simon # Wifi
#             state: 'not_home'
#           - condition: state
#             entity_id: device_tracker.flos_iphone # Wifi
#             state: 'not_home'
#           - condition: state
#             entity_id: device_tracker.iphonevranziska # Wifi
#             state: 'not_home'
#           - condition: state
#             entity_id: device_tracker.iphone_von_christian # GPS
#             state: 'home' #GPS
#           - condition: state
#             entity_id: device_tracker.simons_iphone
#             state: 'not_home' # GPS
#           - condition: state
#             entity_id: device_tracker.flos_iphone_2
#             state: 'not_home' # GPS
#       - condition: and
#         conditions:
#           - condition: state
#             entity_id: device_tracker.iphonevhristian # Wifi
#             state: 'not_home'
#           - condition: state
#             entity_id: device_tracker.flos_iphone # Wifi
#             state: 'not_home'
#           - condition: state
#             entity_id: device_tracker.iphonevranziska # Wifi
#             state: 'not_home'
#           - condition: state
#             entity_id: device_tracker.iphone_von_christian # GPS
#             state: 'not_home' #GPS
#           - condition: state
#             entity_id: device_tracker.simons_iphone
#             state: 'home' # GPS
#           - condition: state
#             entity_id: device_tracker.flos_iphone_2
#             state: 'not_home' # GPS
#       - condition: and
#         conditions:
#           - condition: state
#             entity_id: device_tracker.iphonevhristian # Wifi
#             state: 'not_home'
#           - condition: state
#             entity_id: device_tracker.iphone_von_simon # Wifi
#             state: 'not_home'
#           - condition: state
#             entity_id: device_tracker.iphonevranziska # Wifi
#             state: 'not_home'
#           - condition: state
#             entity_id: device_tracker.iphone_von_christian # GPS
#             state: 'not_home' #GPS
#           - condition: state
#             entity_id: device_tracker.simons_iphone
#             state: 'not_home' # GPS
#           - condition: state
#             entity_id: device_tracker.flos_iphone_2
#             state: 'home' # GPS
#       - condition: and
#         conditions:
#           - condition: state
#             entity_id: device_tracker.iphonevhristian # Wifi
#             state: 'not_home'
#           - condition: state
#             entity_id: device_tracker.iphone_von_simon # Wifi
#             state: 'not_home'
#           - condition: state
#             entity_id: device_tracker.flos_iphone # Wifi
#             state: 'not_home'
#           - condition: state
#             entity_id: device_tracker.iphone_von_christian # GPS
#             state: 'not_home' #GPS
#           - condition: state
#             entity_id: device_tracker.simons_iphone
#             state: 'not_home' # GPS
#           - condition: state
#             entity_id: device_tracker.flos_iphone_2
#             state: 'not_home' # GPS
#   action:
#     ###################################################
#     # TODO: Add notification funtionallity if needed
#     ###################################################
#     - service: hue.hue_activate_scene
#       data:
#         group_name: Wohnzimmer
#         scene_name: Entspannt
#     - service: hue.hue_activate_scene
#       data_template:
#         group_name: >
#           {% if  {{ trigger.entity_id }} == 'device_tracker.iphonevhristian' %}
#             Christian
#           {% elif  {{ trigger.entity_id }} == 'device_tracker.iphone_von_simon' %}
#             Simon
#           {% elif  {{ trigger.entity_id }} == 'device_tracker.flos_iphone' or {{ trigger.entity_id }} == 'entity_id: device_tracker.iphonevranziska'%}
#             Flo
#           {% end if %}
#         scene_name: > 
#           {% if  {{ trigger.entity_id }} == 'device_tracker.iphonevhristian' %}
#             Christian
#           {% elif  {{ trigger.entity_id }} == 'device_tracker.iphone_von_simon' %}
#             Simon
#           {% elif  {{ trigger.entity_id }} == 'device_tracker.flos_iphone' or {{ trigger.entity_id }} == 'entity_id: device_tracker.iphonevranziska'%}
#             Flo
#           {% end if %}

###################################################
# Comming Home automation - Christian
###################################################
# - alias: 'Christian Coming Home Light'
#   initial_state: true
#   trigger:
#     platform: state
#     entity_id: device_tracker.iphonevhristian #WiFi based
#     to: 'home'
#   condition:
#     condition: and
#     conditions:
#       - condition: state
#         entity_id: device_tracker.iphone_von_simon # Wifi Based Simon
#         state: 'not_home'
#       - condition: state
#         entity_id: device_tracker.flos_iphone_2 # Wifi Based Flo
#         state: 'not_home'
#       - condition: state
#         entity_id: device_tracker.iphonevranziska # Wifi Based Franziska
#         state: 'not_home'
#       - condition: state
#         entity_id: device_tracker.iphone_von_christian_2 # GPS Chris
#         state: 'home' #GPS confirmation that person is home
#       - condition: state
#         entity_id: Based device_tracker.flos_iphone_3 # GPS Based Flo
#         state: 'not_home' #GPS confirmation that person is not home
#       - condition: state
#         entity_id: device_tracker.simons_iphone_2 # GPS Based Simon
#         state: 'not_home' #GPS confirmation that person is not home
#       - condition: or
#         conditions:
#           - condition: sun
#             before: sunrise
#             before_offset: "+01:00:00"
#           - condition: sun
#             after: sunset
#             after_offset: "-01:00:00"
#   action:
#     - service: hue.hue_activate_scene
#       data:
#         group_name: Wohnzimmer
#         scene_name: Entspannt
#     - service: hue.hue_activate_scene
#       data:
#         group_name: Christian
#         scene_name: Entspannen

# - alias: 'Christian Coming Home Music'
#   initial_state: true
#   trigger:
#     platform: state
#     entity_id: device_tracker.iphonevhristian #WiFi based
#     to: 'home'
#   condition:
#     condition: and
#     conditions:
#       - condition: state
#         entity_id: device_tracker.iphone_von_simon # Wifi Based Simon
#         state: 'not_home'
#       - condition: state
#         entity_id: device_tracker.flos_iphone_2 # Wifi Based Flo
#         state: 'not_home'
#       - condition: state
#         entity_id: device_tracker.iphonevranziska # Wifi Based Franziska
#         state: 'not_home'
#       - condition: state
#         entity_id: device_tracker.iphone_von_christian_2 # GPS Chris
#         state: 'home' #GPS confirmation that person is home
#       - condition: state
#         entity_id: Based device_tracker.flos_iphone_3 # GPS Based Flo
#         state: 'not_home' #GPS confirmation that person is not home
#       - condition: state
#         entity_id: device_tracker.simons_iphone_2 # GPS Based Simon
#         state: 'not_home' #GPS confirmation that person is not home
#   action:
#     ###################################################
#     # TODO: Add notification funtionallity if needed
#     ###################################################
#     - service: media_player.volume_set
#       data:
#         entity_id: media_player.wohnzimmer
#         volume_level: 0.1
#     - service: media_player.media_play
#       data:
#         entity_id: media_player.wohnzimmer
#     ###################################################
#     # TODO: Find a solution to first say "hello" to the person coming home and then playing a specific plylist
#     ###################################################
        
# - alias: 'Christian Leaving Home'
#   initial_state: true
#   trigger:
#     - platform: state
#       entity_id: device_tracker.iphonevhristian # WiFi Based
#       to: 'not_home'
#     - platform: state
#       entity_id: device_tracker.iphone_von_christian # GPS Based
#       to: 'not_home'
#   condition:
#     condition: and
#     conditions:
#       - condition: state
#         entity_id: device_tracker.iphone_von_simon # Wifi Based Simon
#         state: 'not_home'
#       - condition: state
#         entity_id: device_tracker.flos_iphone_2 # Wifi Based Flo
#         state: 'not_home'
#       - condition: state
#         entity_id: device_tracker.iphonevranziska # Wifi Based Franziska
#         state: 'not_home'
#       - condition: state
#         entity_id: device_tracker.iphonevhristian # WiFi Based
#         state: 'not_home'
#       - condition: state
#         entity_id: device_tracker.iphone_von_christian_2 # GPS Chris
#         state: 'not_home' #GPS confirmation that person is home
#       - condition: state
#         entity_id: Based device_tracker.flos_iphone_3 # GPS Based Flo
#         state: 'not_home' #GPS confirmation that person is not home
#       - condition: state
#         entity_id: device_tracker.simons_iphone_2 # GPS Based Simon
#         state: 'not_home' #GPS confirmation that person is not home
#       ###################################################
#       # TODO: Add Flos GPS tracking as a additional Condition
#       ###################################################
#   action:
#     ###################################################
#     # TODO: Add notification funtionallity if needed
#     ###################################################
#     - service: media_player.media_pause
#       data:
#         entity_id: media_player.wohnzimmer
#     - service: light.turn_off
#       data:
#         entity_id: all

# ###################################################
#   # Comming Home automation - Flo
# ###################################################
- alias: 'Flo Coming Home Light'
  initial_state: true
  trigger:
    platform: state
    entity_id: device_tracker.flos_iphone # Wifi Based
    to: 'home'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: device_tracker.iphone_von_simon # Wifi Based
        state: 'not_home'
      - condition: state
        entity_id: device_tracker.iphonevhristian #WiFi based
        state: 'not_home'
      - condition: state
        entity_id: device_tracker.iphone_von_christian # GPS Based
        state: 'not_home'
      ###################################################
      # TODO: Add Flos GPS tracking as a additional Condition
      ###################################################
      #- condition: state
      #  entity_id: device_tracker.iphone_von_flo # GPS Based
      #  state: 'home' #GPS confirmation that person is home
      
      #- condition: state ###############################################TODO: Problem Solving needed
      #  entity_id: device_tracker.simons_iphone # GPS Based
      #  state: 'not_home'
      - condition: or
        conditions:
          - condition: sun
            before: sunrise
            before_offset: "+01:00:00"
          - condition: sun
            after: sunset
            after_offset: "-01:00:00"
  action:
    - service: hue.hue_activate_scene
      data:
        group_name: Wohnzimmer
        scene_name: Entspannt
    - service: hue.hue_activate_scene
      data:
        group_name: Flo
        scene_name: Entspannen

# - alias: 'Flo Coming Home Music'
#   initial_state: true
#   trigger:
#     platform: state
#     entity_id: device_tracker.flos_iphone #WiFi based
#     to: 'home'
#   condition:
#     condition: and
#     conditions:
#       - condition: state
#         entity_id: device_tracker.iphone_von_simon # Wifi Based
#         state: 'not_home'
#       - condition: state
#         entity_id: device_tracker.iphonevhristian # Wifi Based
#         state: 'not_home'
#       - condition: state
#         entity_id: device_tracker.iphone_von_christian # GPS Based
#         state: 'not_home' #GPS confirmation that person is home
#       #- condition: state ###############################################TODO: Problem Solving needed
#       #  entity_id: device_tracker.simons_iphone # GPS Based
#       #  state: 'not_home'
#       ###################################################
#       # TODO: Add Flos GPS tracking as a additional Condition as "HOME"
#       ###################################################
#   action:
#     ###################################################
#     # TODO: Add notification funtionallity if needed
#     ###################################################
#     - service: media_player.volume_set
#       data:
#         entity_id: media_player.wohnzimmer
#         volume_level: 0.1
#     - service: media_player.media_play
#       data:
#         entity_id: media_player.wohnzimmer
#     ###################################################
#     # TODO: Find a solution to first say "hello" to the person coming home and then playing a specific plylist
#     ###################################################
        
# - alias: 'Flo Leaving Home'
#   initial_state: true
#   trigger:
#     - platform: state
#       entity_id: device_tracker.flos_iphone # WiFi Based
#       to: 'not_home'
#     #- platform: state #####TODO:  as Flo GPS 
#     #  entity_id: device_tracker.iphone_von_christian # GPS Based
#     #  to: 'not_home'
#   condition:
#     condition: and
#     conditions:
#       - condition: state
#         entity_id: device_tracker.iphone_von_simon # Wifi Based
#         state: 'not_home'
#       - condition: state
#         entity_id: device_tracker.iphonevhristian # Wifi Based
#         state: 'not_home'
#       - condition: state
#         entity_id: device_tracker.iphone_von_christian # GPS Based
#         state: 'not_home' #GPS confirmation that person is home
#       #- condition: state ############################################### TODO: Problem Solving needed
#       #  entity_id: device_tracker.simons_iphone # GPS Based
#       #  state: 'not_home'
#       #- condition: state
#       #  entity_id: device_tracker. # GPS Based
#       #  state: 'not_home' #GPS confirmation that person is home
#       ###################################################
#       # TODO: Add Flos GPS tracking as a additional Condition
#       ###################################################
#   action:
#     ###################################################
#     # TODO: Add notification funtionallity if needed
#     ###################################################
#     - service: media_player.media_pause
#       data:
#         entity_id: media_player.wohnzimmer
#     - service: light.turn_off
#       data:
#         entity_id: all


# ###################################################
#   # Comming Home automation - Simon
# ###################################################
# - alias: 'Simon Coming Home Light'
#   initial_state: true
#   trigger:
#     platform: state
#     entity_id: device_tracker.iphone_von_simon # Wifi Based
#     to: 'home'
#   condition:
#     condition: and
#     conditions:
#       - condition: state
#         entity_id: device_tracker.flos_iphone # Wifi Based
#         state: 'not_home'
#       - condition: state
#         entity_id: device_tracker.iphonevhristian #WiFi based
#         state: 'not_home'
#       - condition: state
#         entity_id: device_tracker.iphone_von_christian # GPS Based
#         state: 'not_home'
#       ###################################################
#       # TODO: Add Flos GPS tracking as a additional Condition
#       ###################################################
#       #- condition: state
#       #  entity_id: device_tracker.simons_iphone # GPS Based
#       #  state: 'home' #GPS confirmation that person is home
#       - condition: or
#         conditions:
#           - condition: sun
#             before: sunrise
#             before_offset: "+01:00:00"
#           - condition: sun
#             after: sunset
#             after_offset: "-01:00:00"
#   action:
#     - service: hue.hue_activate_scene
#       data:
#         group_name: Wohnzimmer
#         scene_name: Entspannt
#     - service: hue.hue_activate_scene
#       data:
#         group_name: Simon
#         scene_name: Entspannen

# - alias: 'Simon Coming Home Music'
#   initial_state: true
#   trigger:
#     platform: state
#     entity_id: device_tracker.iphone_von_simon #WiFi based
#     to: 'home'
#   condition:
#     condition: and
#     conditions:
#       - condition: state
#         entity_id: device_tracker.flos_iphone # Wifi Based
#         state: 'not_home'
#       - condition: state
#         entity_id: device_tracker.iphonevhristian # Wifi Based
#         state: 'not_home'
#       - condition: state
#         entity_id: device_tracker.iphone_von_christian # GPS Based
#         state: 'not_home' #GPS confirmation that person is home
#       #- condition: state ###############################################TODO: Problem Solving needed
#       #  entity_id: device_tracker.simons_iphone # GPS Based
#       #  state: 'home'
#       ###################################################
#       # TODO: Add Flos GPS tracking as a additional Condition as "NOT_HOME"
#       ###################################################
#   action:
#     ###################################################
#     # TODO: Add notification funtionallity if needed
#     ###################################################
#     - service: media_player.volume_set
#       data:
#         entity_id: media_player.wohnzimmer
#         volume_level: 0.1
#     - service: media_player.media_play
#       data:
#         entity_id: media_player.wohnzimmer
#     ###################################################
#     # Find a solution to first say "hello" to the person coming home and then playing a specific plylist
#     ###################################################
        
# - alias: 'Simon Leaving Home'
#   initial_state: true
#   trigger:
#     - platform: state
#       entity_id: device_tracker.iphone_von_simon # WiFi Based
#       to: 'not_home'
#     #- platform: state ##### as Flo GPS
#     #  entity_id: device_tracker.iphone_von_christian # GPS Based
#     #  to: 'not_home'
#   condition:
#     condition: and
#     conditions:
#       - condition: state
#         entity_id: device_tracker.flos_iphone # Wifi Based
#         state: 'not_home'
#       - condition: state
#         entity_id: device_tracker.iphonevhristian # Wifi Based
#         state: 'not_home'
#       - condition: state
#         entity_id: device_tracker.iphone_von_christian # GPS Based
#         state: 'not_home' #GPS confirmation that person is home
#       #- condition: state ###############################################TODO: Problem Solving needed
#       #  entity_id: device_tracker.simons_iphone # GPS Based
#       #  state: 'not_home'
#       #- condition: state
#       #  entity_id: device_tracker. # GPS Based
#       #  state: 'not_home' #GPS confirmation that person is home
#       ###################################################
#       # TODO: Add Flos GPS tracking as a additional Condition
#       ###################################################
#   action:
#     ###################################################
#     # TODO: Add notification funtionallity if needed
#     ###################################################
#     - service: media_player.media_pause
#       data:
#         entity_id: media_player.wohnzimmer
#     - service: light.turn_off
#       data:
#         entity_id: all